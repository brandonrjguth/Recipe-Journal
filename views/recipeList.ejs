<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe List</title>
    <link rel="stylesheet" type="text/css" href="/main.css">
    <link rel="stylesheet" type="text/css" href="/recipeList.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,700;1,100&display=swap" rel="stylesheet">
</head>
<body>
    
    <%- include('partials/header') %>
    <div class="content">


        <h1><%if (favourites === true){%>
            Favourites
        <%} else {%>Recipes<%}%></h1>
        
        <!--For each recipe in the collection, add a link to the recipe as list item in the ordered list-->
        <ul>
            <% for(var i=0; i < recipeList.length; i++){
            
                if (!recipeList[i].isLink && !recipeList[i].isImg)
                {%>
                <div class="contentRow">
        
                    <li>
                        <span>>></span>
                        <a href="/recipe/<%=recipeList[i].recipeTitleShort%>"><%=recipeList[i].title%></a>
                    </li>
    
                    <div class="buttons row">
                        <form class="col deleteRecipe" action='/deleteRecipe' method='post'>
                            <input type="hidden" name="recipeTitleShort" value="<%=recipeList[i].recipeTitleShort%>"></input>
                            <button type="button" class="deleteBtn"><img src="/imgs/trash-2.svg"></button>
                        </form>
                        <button class="editBtn"><a href="/recipe/<%=recipeList[i].recipeTitleShort%>/editRecipe"><img src="/imgs/edit.svg"></a></button>
                        <form class="col favouriteRecipe" action='/favouriteRecipe' method='post'>
                            <input type="hidden" name="recipeTitleShort" value="<%=recipeList[i].recipeTitleShort%>"></input>
                            <button class="favouriteBtn"><img src="/imgs/<%if (recipeList[i].favourite === true){%>heart-f-filled-red.svg<%} else {%>heart-f-filled.svg<%}%>"></button>
                        </form>
                    </div>
                </div>
                <%}
            }%>
        </ul>

        <h1>Saved Links</h1>

        <ul>
        <% for(var i=0; i < recipeList.length; i++){
            
            if (recipeList[i].isLink)
            {%>
            <div class="contentRow">
            
                <li>
                    <span>>></span>
                    <a href="<%=recipeList[i].recipeURL%>"><%=recipeList[i].title%></a>
                </li>

                <div class="buttons row">
                    <form class="col deleteRecipe" action='/deleteRecipe' method='post'>
                        <input type="hidden" name="recipeTitleShort" value="<%=recipeList[i].recipeTitleShort%>"></input>
                        <button type="button" class="deleteBtn"><img src="/imgs/trash-2.svg"></button>
                    </form>
                    <button class="editBtn"><a href="/recipe/<%=recipeList[i].recipeTitleShort%>/editRecipe"><img src="/imgs/edit.svg"></a></button>
                    <form class="col favouriteRecipe" action='/favouriteRecipe' method='post'>
                        <input type="hidden" name="recipeTitleShort" value="<%=recipeList[i].recipeTitleShort%>"></input>
                        <button class="favouriteBtn" type="button"><img class="heartIcon" src="/imgs/<%if (recipeList[i].favourite === true){%>heart-f-filled-red.svg<%} else {%>heart-f-filled.svg<%}%>"></button>
                    </form>
                </div>
            </div>
            <%}
        }%>
        </ul>

        <h1>Picture Recipes</h1>

        <ul>
        <% for(var i=0; i < recipeList.length; i++){
            
            if (recipeList[i].isImg)
            {%>
            <div class="contentRow">
            
                <li>
                    <span>>></span>
                    <a href="/recipeImg/<%=recipeList[i].recipeTitleShort%>"><%=recipeList[i].title%></a>
                </li>

                <div class="buttons row">
                    <form class="col deleteRecipe" action='/deleteRecipe' method='post'>
                        <input type="hidden" name="recipeTitleShort" value="<%=recipeList[i].recipeTitleShort%>"></input>
                        <button type="button" class="deleteBtn"><img src="/imgs/trash-2.svg"></button>
                    </form>
                    <button class="editBtn"><a href="/recipe/<%=recipeList[i].recipeTitleShort%>/editRecipe"><img src="/imgs/edit.svg"></a></button>
                    <form class="col favouriteRecipe" action='/favouriteRecipe' method='post'>
                        <input type="hidden" name="recipeTitleShort" value="<%=recipeList[i].recipeTitleShort%>"></input>
                        <button class="favouriteBtn" type="button"><img class="heartIcon" src="/imgs/<%if (recipeList[i].favourite === true){%>heart-f-filled-red.svg<%} else {%>heart-f-filled.svg<%}%>"></button>
                    </form>
                </div>
            </div>
            <%}
        }%>
        </ul>
    </div>

    <script>

        let deleteBtns = document.querySelectorAll(".deleteBtn");
        let deleteForm = document.querySelectorAll(".deleteRecipe");
        let favouriteForms = document.querySelectorAll(".favouriteRecipe");
        favouriteForms.forEach((form, index) => {
            let favouriteButton = form.querySelector(".favouriteBtn");

            favouriteButton.addEventListener("click", function(event){
                event.preventDefault();

                // Toggle the heart icon
                let heartIcon = favouriteButton.querySelector('img');
                let currentSrc = heartIcon.getAttribute('src');
                let newSrc = currentSrc.includes('heart-f-filled-red') ? '/imgs/heart-f-filled.svg' : '/imgs/heart-f-filled-red.svg';
                heartIcon.setAttribute('src', newSrc);

                // Send the form data asynchronously using Fetch API
                form.submit();
            });
        });
        
        for (i = 0; i < deleteBtns.length; i++) {
            let attachedForm = i;
            deleteBtns[i].addEventListener("click", function(){
                //Make user confirm recipe deletion before submitting the form
                const response = confirm("Are you sure you want to delete this recipe?")
                if (response === true){
                    deleteForm[attachedForm].submit();
                }
            })
        }

    </script>
        
</body>
</html>